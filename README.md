# spp-network-perf
One Identity Safeguard for Privileged Passwords network performance testing tool

## Support

One Identity open source projects are supported through [One Identity GitHub issues](https://github.com/OneIdentity/spp-network-perf/issues) and the [One Identity Community](https://www.oneidentity.com/community/). This includes all scripts, plugins, SDKs, modules, code snippets or other solutions. For assistance with any One Identity GitHub project, please raise a new Issue on the [One Identity GitHub project](https://github.com/OneIdentity/spp-network-perf/issues) page. You may also visit the [One Identity Community](https://www.oneidentity.com/community/) to ask questions.  Requests for assistance made through official One Identity Support will be referred back to GitHub and the One Identity Community forums where those requests can benefit all users.

## Prerequisites
This tool was developed on a Linux workstation with the goal to keep the
prerequisites as minimal as possible. Using docker provides the ability to run
tooling in a container without changing what is installed on the host system.

Software Prerequisites:
- Linux (developed on Ubuntu 16.04 but any modern distro should work)
- bash (developed with version 4.4.20, probably 4.0+)
- curl (developed with version 7.58.0 but any should work)
- docker (developed with version 17.05.0-ce)

Hardware Prerequisites:
- Physical or Virtual
- --- _No performance minimums have been researched_ ---

It is important to make sure that the current user has appropriate permissions
to interact with the docker daemon. If you don't, you will see an error message
that looks like:

```
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: ...
```

The best way to fix this is to add your current user to the `docker` group.

```
$ sudo usermod -a -G docker $USER
```

Then, log out and log back in again to refresh your group memberships.

If the error still persists then you need to make sure the docker socket has a
group owner of `docker`. Then, try restarting the docker daemon, or reboot the
server. You can verify that docker is running properly when the following
command works.

```
$ docker run hello-world
```

## Installation
The easiest way to get spp-network-perf is to use `git`. To check out the source
code using `git` just type the following command:

```Bash
$ git clone https://github.com/OneIdentity/spp-network-perf.git
```

This will create a `spp-network-perf` directory in your current directory that
contains the entire spp-network-perf source tree.

If you do not have `git` then you can accomplish the same thing by running this
command line:

```Bash
$ curl -sSLO https://github.com/OneIdentity/spp-network-perf/archive/master.zip; unzip master.zip; rm master.zip; mv spp-network-perf-master spp-network-perf
```

## Description
spp-network-perf is built to simulate traffic that would be similar to traffic
generated by a functioning Safeguard traffic. To avoid too much setup and tear
down, the VPN technology is included within a Linux container image.

The `Dockerfile` in the root directory describes how to build the container
image. The `build.sh` script will build the container image.

When the container runs it creates the virtual network interface, and starts the
VPN and an iperf server. An additional web service is started so that the client
test script can execute processes within the container, because the VPN virtual
network interface is only available from inside the container.

## Running Tests
Testing requires at least two hosts. You may run this on up to five hosts at a
time, and you can run multiple clients against each host simultaneously.
However, in this section we will just demonstrate how to run a simple test
between two nodes.

#### Host One
1. Run the `start-service.sh` script.
   ```
   $ ./start-service.sh
   ```
   The initial output will be from `build.sh` which is building the container
   image. After the image is built, the script will prompt for IP addresses:
   ```
   Local IP Address: 10.5.38.38
   Peer IP addresses (comma-delimited): 10.5.35.25
   ```
   Type in the IP address of `Host Two`.
2. To make sure that the service is running correctly, run:
   ```
   $ ./client.sh -c status
   ```
   This should print out some JSON data about the system running in the
   container. You should see process information for `Tincd` and `Iperf`.

#### Host Two
1. Run the `start-service.sh` script.
   ```
   $ ./start-service.sh
   ```
   Again you will see build output and a prompt for IP addresses:
   ```
   Local IP Address: 10.5.35.25
   Peer IP addresses (comma-delimited): 10.5.38.38
   ```
   Type in the IP address of `Host One`.
2. To make sure that the service is running correctly, run:
   ```
   $ ./client.sh -c status
   ```
   This should print out similar JSON data. Make sure you see process
   information for `Tincd` and `Iperf`.

#### Basic Test (From Host One)
1. Make sure you have basic connectivity over the VPN by running:
   ```
   $ ./client.sh -c ping 10.5.35.25
   ```
   This will run a ping over the VPN and will display the output when it is
   finished. If this doesn't work, then you will need to debug why the VPN was
   unable to connect.
2. Do a performance test over the VPN by running:
   ```
   $ ./client.sh -c iperf 10.5.35.25
   ```
   This will run a 20 second performance test over the VPN. The connections
   over the VPN are TCP connections to port 443 which is similar to some of the
   traffic that traverses the Safeguard VPN.

#### How To Stop
The container will continue running on both `Host One` and `Host Two` until it
is stopped. Use the `stop-service.sh` script to stop them.

## Additional Information
There are two additional scripts included. Running `debug-service.sh` will drop
you at a command prompt inside a running container. You can make changes to
configuration and restart the VPN or the iperf server. Much of the initial
setup inside the container is created by `/scripts/start.sh`.

The other script is `clean.sh`. That script will remove the container image and
any stopped containers. To finish cleaning up, just delete the directory you
created when you pulled down the code.

